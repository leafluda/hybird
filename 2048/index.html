<html lang="ko">
<head>
    <meta charset="UTF-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>2048</title>
    <style>
        #app{
    top: 40%;
    left: 50%;
    transform: translate(-50%,-50%);
    position: relative;
    width: 590px;       
    height: 590px;
    background-color: beige;
    display: none;
    grid-template-columns: 1fr 1fr 1fr 1fr;
    grid-template-rows: 1fr 1fr 1fr 1fr;
    grid-gap: 10px;
    padding : 10px;     
    border-radius: 20;      
}

#unstart{
    top: 40%;
    left: 50%;
    transform: translate(-50%,-50%);
    position: relative;
    width: 590px;       
    height: 590px;
    background-color: beige; 
    grid-gap: 10px;
    padding : 10px;  
    border-radius: 20;      
}

#win{
    top: 40%;
    left: 50%;
    transform: translate(-50%,-50%);
    position: relative;
    display: none;
    width: 590px;       
    height: 590px;
    grid-gap: 10px;
    padding : 10px;  
    background-color: beige;   
    border-radius: 20;      
}

#gameo{
    top: 40%;
    left: 50%;
    transform: translate(-50%,-50%);
    position: relative;
    display: none;
    width: 590px;       
    height: 590px;
    grid-gap: 10px;
    padding : 10px;  
    background-color: beige;   
    border-radius: 20;      
}

#UI{
    top: 10%;
    left: 50%;
    transform: translate(-50%,-50%);
    position: relative;
    width: 590px;
    height: 100px;
    background-color: beige;
    grid-gap: 10px;
    padding : 10px;     
    border-radius: 20; 
}

.bg{            
    background-color: burlywood;
    text-align: center;   
    line-height: 1.8;
    font-size: 70;
    font-family: cursive;
    border-radius: 20;
}

.block{
    position: absolute;
    left: 20;
    top: 20;
    width: 120;
    height: 120;
    background-color: rgb(234, 234, 234);
    text-align: center;            
    line-height: 1.6;
    font-size: 70;
    font-family: cursive;
    border-radius: 20;
}

.btn-12{
  position: relative;
  top: 30%;
  left: 40%;
  border:none;
  box-shadow: none;
  width: 130px;
  height: 40px;
  line-height: 42px;
  -webkit-perspective: 230px;
  perspective: 230px;
}
.btn-12 span {
  background: rgb(0,172,238);
background: linear-gradient(0deg, rgba(0,172,238,1) 0%, rgba(2,126,251,1) 100%);
  display: block;
  position: absolute;
  width: 130px;
  height: 40px;
  box-shadow:inset 2px 2px 2px 0px rgba(255,255,255,.5),
   7px 7px 20px 0px rgba(0,0,0,.1),
   4px 4px 5px 0px rgba(0,0,0,.1);
  border-radius: 5px;
  margin:0;
  text-align: center;
  -webkit-box-sizing: border-box;
  -moz-box-sizing: border-box;
  box-sizing: border-box;
  -webkit-transition: all .3s;
  transition: all .3s;
}
.btn-12 span:nth-child(1) {
  box-shadow:
   -7px -7px 20px 0px #fff9,
   -4px -4px 5px 0px #fff9,
   7px 7px 20px 0px #0002,
   4px 4px 5px 0px #0001;
  -webkit-transform: rotateX(90deg);
  -moz-transform: rotateX(90deg);
  transform: rotateX(90deg);
  -webkit-transform-origin: 50% 50% -20px;
  -moz-transform-origin: 50% 50% -20px;
  transform-origin: 50% 50% -20px;
}
.btn-12 span:nth-child(2) {
  -webkit-transform: rotateX(0deg);
  -moz-transform: rotateX(0deg);
  transform: rotateX(0deg);
  -webkit-transform-origin: 50% 50% -20px;
  -moz-transform-origin: 50% 50% -20px;
  transform-origin: 50% 50% -20px;
}
.btn-12:hover span:nth-child(1) {
  box-shadow:inset 2px 2px 2px 0px rgba(255,255,255,.5),
   7px 7px 20px 0px rgba(0,0,0,.1),
   4px 4px 5px 0px rgba(0,0,0,.1);
  -webkit-transform: rotateX(0deg);
  -moz-transform: rotateX(0deg);
  transform: rotateX(0deg);
}
.btn-12:hover span:nth-child(2) {
  box-shadow:inset 2px 2px 2px 0px rgba(255,255,255,.5),
   7px 7px 20px 0px rgba(0,0,0,.1),
   4px 4px 5px 0px rgba(0,0,0,.1);
 color: transparent;
  -webkit-transform: rotateX(-90deg);
  -moz-transform: rotateX(-90deg);
  transform: rotateX(-90deg);
}
    </style>
</head>
<body onload="openfile()">
    
    <div id="UI">
        <button class="custom-btn btn-12" onclick="start()"><span>Click!</span><span>start</span></button>
        <p id = "scoretext"></p>
    </div>
    <div id="unstart">Click Start Button</div>
    <div id="app">
        <div class="bg"></div>
        <div class="bg"></div> 
        <div class="bg"></div> 
        <div class="bg"></div> 
        <div class="bg"></div> 
        <div class="bg"></div> 
        <div class="bg"></div> 
        <div class="bg"></div> 
        <div class="bg"></div> 
        <div class="bg"></div> 
        <div class="bg"></div> 
        <div class="bg"></div> 
        <div class="bg"></div> 
        <div class="bg"></div> 
        <div class="bg"></div> 
        <div class="bg"></div> 
    </div>
    <div id="win">You Win</div>
    <div id="gameo">You Lose</div>
    <script>

    var board = [[0,0,0,0],
                 [0,0,0,0],
                 [0,0,0,0],
                 [0,0,0,0]];

    var temp = [[0,0,0,0],
                [0,0,0,0],
                [0,0,0,0],
                [0,0,0,0]];

    var check = [[0,0,0,0],
                 [0,0,0,0],
                 [0,0,0,0],
                 [0,0,0,0]];
    
    var undoboard = [[0,0,0,0],
                     [0,0,0,0],
                     [0,0,0,0],
                     [0,0,0,0]];
    var gamestate = true;

    var gameover = false;

    var score = 0;

    var gamewin = false;

    var blocks;

    var scoretext;
    
    var move;

    var moveLpx = [[0,0,0,0],
                  [0,0,0,0],
                  [0,0,0,0],
                  [0,0,0,0]];

    var moveTpx = [[0,0,0,0],
                  [0,0,0,0],
                  [0,0,0,0],
                  [0,0,0,0]];
    
    var moveComplete = [[0,0,0,0],
                      [0,0,0,0],
                      [0,0,0,0],
                      [0,0,0,0]];


    var moveAfter = [[0,0,0,0],
                     [0,0,0,0],
                     [0,0,0,0],
                     [0,0,0,0]];
    
    var intervalId;

    var onoff = false;

        function compute(key){
            move = false;

            for(let x = 0; x < 4 ; x++){
                for(let y = 0; y < 4; y++){
                    undoboard[x][y] = check[x][y];
                    temp[x][y] = 0;
                    check[x][y] = board[x][y];
                    moveAfter[x][y] = 0;
                }
            }
            
            switch (key) {
            case 'l' :
            animationload();
            break;
            case 'n' :
            newblock();
            break;
            case 'd' :
            draw();
            break;
            case 'u' :
            undo();
            break;
            case 'r' : 
            resetpx();
            break;
            case 'ArrowRight':
                for(let x = 0; x < 4 ; x++){
                    var a = 3;
                    for(let y = 3; y > -1 ; y--){ 
                        if(board[x][y] !=0){
                            if(temp[x][a]==0){
                                temp[x][a] = board[x][y];
                                moveAfter[x][y] = a;
                            }
                        a--;
                        }
                    }
                }

                for(let x = 0; x < 4 ; x++){
                    for(let y = 2; y > -1; y--){ 
                        if(temp[x][y]!=0 && temp[x][y]==temp[x][y+1]){
                            temp[x][y+1] = temp[x][y+1] + temp[x][y];
                            temp[x][y] = 0;
                            moveAfter[x][y] = moveAfter[x][y]+1;
                        }
                    }
                }
                console.log(moveAfter);
                for(let x = 0; x < 4 ; x++){
                    for(let y = 0; y < 4; y++){ 
                        board[x][y] = 0;
                    }
                }

                for(let x = 0; x < 4 ; x++){
                    var a = 3;
                    for(let y = 3; y > -1 ; y--){ 
                        if(temp[x][y] !=0){
                            if(board[x][a]==0){
                                board[x][a] = temp[x][y];
                                moveAfter[x][y] = a;  
                            }
                        a--;
                        }
                    }
                }
                console.log(moveAfter);
                resetpx();
                intervalId = setInterval(rightAnimation,1);
                break;
            case 'ArrowLeft':
                for(let x = 0; x < 4 ; x++){
                    var a = 0;
                    for(let y = 0; y < 4; y++){ 
                        if(board[x][y] !=0){
                            if(temp[x][a]==0){
                                temp[x][a] = board[x][y]; 
                                moveAfter[x][y] = a;
                            }
                        a++;
                        }
                    }
                }

                for(let x = 0; x < 4 ; x++){
                    for(let y = 1; y < 4; y++){
                            if(temp[x][y]!=0 && temp[x][y]==temp[x][y-1]){
                            temp[x][y-1] = temp[x][y-1] + temp[x][y];
                            temp[x][y] = 0;
                            moveAfter[x][y] = moveAfter[x][y]-1;
                        }
                    }
                }

                for(let x = 0; x < 4 ; x++){
                    for(let y = 0; y < 4; y++){ 
                        board[x][y] = 0;
                    }
                }

                for(let x = 0; x < 4 ; x++){
                    var a = 0;
                    for(let y = 0; y < 4; y++){ 
                        if(temp[x][y] !=0){
                            if(board[x][a]==0){
                                board[x][a] = temp[x][y];
                                moveAfter[x][y] = a;  
                            }
                        a++;
                        }
                    }
                }
                resetpx();
                intervalId = setInterval(LeftAnimation,1);
                break;
            case 'ArrowUp':
                for(let y = 0; y < 4 ; y++){
                    var a = 0;
                    for(let x = 0; x < 4; x++){ 
                        if(board[x][y] !=0){
                            if(temp[a][y]==0){
                                temp[a][y] = board[x][y];  
                            }
                        a++;
                        }
                    }
                }

                for(let y = 0; y < 4 ; y++){
                    for(let x = 1; x < 4; x++){ 
                        if(temp[x][y]==temp[x-1][y]){
                            temp[x-1][y] = temp[x-1][y] + temp[x][y];
                            temp[x][y] = 0;
                        }
                    }
                }

                for(let x = 0; x < 4 ; x++){
                    for(let y = 0; y < 4; y++){ 
                    board[x][y] = 0;
                    }
                }

                for(let y = 0; y < 4 ; y++){
                    var a = 0;
                    for(let x = 0; x < 4; x++){ 
                        if(temp[x][y] !=0){
                            if(board[a][y]==0){
                                board[a][y] = temp[x][y];  
                            }
                            a++;
                        }
                    }
                }
                break;
            case 'ArrowDown':
                for(let y = 0; y < 4 ; y++){
                    var a = 3;
                    for(let x = 3; x > -1; x--){ 
                        if(board[x][y] !=0){
                            if(temp[a][y]==0){
                                temp[a][y] = board[x][y];  
                            }
                            a--;
                        }
                    }
                }

                for(let y = 0; y < 4 ; y++){
                    for(let x = 2; x > -1; x--){ 
                        if(temp[x][y]==temp[x+1][y]){
                            temp[x+1][y] = temp[x+1][y] + temp[x][y];
                            temp[x][y] = 0;
                        }
                    }
                }

                for(let x = 0; x < 4 ; x++){
                    for(let y = 0; y < 4; y++){ 
                        board[x][y] = 0;
                    }
                }

                for(let y = 0; y < 4 ; y++){
                    var a = 3;
                    for(let x = 3; x > -1; x--){ 
                        if(temp[x][y] !=0){
                            if(board[a][y]==0){
                                board[a][y] = temp[x][y];  
                            }
                            a--;
                        }
                    }
                }
                break;
            }

        }
    
        function endG(){   
            var rl = false;
            var ud = false;

            for(let i= 0; i<4;i++){
                for(let j= 0; j<4;j++){
                    if(board[i][j]==2048){
                        gamestate = false;
                        gamewin = true;
                        var app = document.getElementById('app');
                        var unstart = document.getElementById('unstart');
                        var win = document.getElementById('win');
                        var gameo = document.getElementById('gameo');

                        app.style.display = 'none';
                        unstart.style.display = 'none';
                        win.style.display = 'grid';
                        gameo.style.display = 'none';
                    }
                }
            }

            if(gamewin == false){
                if(gameover==true){
                    gamestate = false;
                    var app = document.getElementById('app');
                    var unstart = document.getElementById('unstart');
                    var win = document.getElementById('win');
                    var gameo = document.getElementById('gameo');

                    app.style.display = 'none';
                    unstart.style.display = 'none';
                    win.style.display = 'none';
                    gameo.style.display = 'grid';
                } 
        
                for(let i= 0; i<4;i++){
                    for(let j= 0; j<3;j++){
                        if(board[i][j] == board[i][j+1]){
                            rl = true;
                        }
                    }
                }

                for(let i= 0; i<3;i++){
                    for(let j= 0; j<4;j++){
                        if(board[i][j] == board[i+1][j]){
                            ud = true;
                        }
                    }
                }

                for(let i= 0; i<3;i++){
                    for(let j= 0; j<4;j++){
                        if(board[i][j] == 0){
                            rl = true;
                            ud = true;
                        }
                    }
                }

                if(rl==false){
                    if(ud==false){
                        gameover = true;
                    }
                } 

            }
        }

        function undo(){
            blocks = document.getElementsByClassName("block");

                for(let i= 0; i<4;i++){
                    for(let j= 0; j<4;j++){
                         blocks[(i*4)+j].innerText = undoboard[i][j]+ "";
                         board[i][j]=undoboard[i][j];
                        blocks[(i*4)+j].style.top = 20+(150*i);
                            blocks[(i*4)+j].style.left = 20+(150*j);
            switch (undoboard[i][j]) {
                case 0:
                    blocks[(i*4)+j].style.display = 'none';
                break;
                case 2:
                    blocks[(i*4)+j].style.display = 'block';
                    blocks[(i*4)+j].style.backgroundColor = '#FFD8D8';
                break;
                case 4:
                    blocks[(i*4)+j].style.display = 'block';
                    blocks[(i*4)+j].style.backgroundColor = '#FAE0C8';
                break;
                case 8:
                    blocks[(i*4)+j].style.display = 'block';
                    blocks[(i*4)+j].style.backgroundColor = '#FAF4C0';
                break;
                case 16:
                blocks[(i*4)+j].style.display = 'block';
                blocks[(i*4)+j].style.backgroundColor = '#CEFBC9';
                break;
                case 32:
                blocks[(i*4)+j].style.display = 'block';
                blocks[(i*4)+j].style.backgroundColor = '#D4F4FA';
                break;
                case 64:
                blocks[(i*4)+j].style.display = 'block';
                blocks[(i*4)+j].style.backgroundColor = '#DAD9FF';
                break;
                case 128:
                blocks[(i*4)+j].style.display = 'block';
                blocks[(i*4)+j].style.backgroundColor = '#E8D9FF';
                break;
                case 256:
                blocks[(i*4)+j].style.display = 'block';
                blocks[(i*4)+j].style.backgroundColor = '#F15F5F';
                break;
                case 512:
                blocks[(i*4)+j].style.display = 'block';
                blocks[(i*4)+j].style.backgroundColor = '#F2CB61';
                break;
                case 1024:
                blocks[(i*4)+j].style.display = 'block';
                blocks[(i*4)+j].style.backgroundColor = '#E5D85C';
                break;
                case 2048:
                blocks[(i*4)+j].style.display = 'block';
                blocks[(i*4)+j].style.backgroundColor = '#86E57F';
                break;
            }
    }
}
        }
        function draw(){
            blocks = document.getElementsByClassName("block");

            for(let i= 0; i<4;i++){
                for(let j= 0; j<4;j++){
                    blocks[(i*4)+j].innerText = board[i][j]+ "";
                    blocks[(i*4)+j].style.top = 20+(150*i);
                    blocks[(i*4)+j].style.left = 20+(150*j);
                        switch (board[i][j]) {
                            case 0:
                                blocks[(i*4)+j].style.display = 'none';
                            break;
                            case 2:
                                blocks[(i*4)+j].style.display = 'block';
                                blocks[(i*4)+j].style.backgroundColor = '#FFD8D8';
                            break;
                            case 4:
                                blocks[(i*4)+j].style.display = 'block';
                                blocks[(i*4)+j].style.backgroundColor = '#FAE0C8';
                            break;
                            case 8:
                                blocks[(i*4)+j].style.display = 'block';
                                blocks[(i*4)+j].style.backgroundColor = '#FAF4C0';
                            break;
                            case 16:
                            blocks[(i*4)+j].style.display = 'block';
                            blocks[(i*4)+j].style.backgroundColor = '#CEFBC9';
                            break;
                            case 32:
                            blocks[(i*4)+j].style.display = 'block';
                            blocks[(i*4)+j].style.backgroundColor = '#D4F4FA';
                            break;
                            case 64:
                            blocks[(i*4)+j].style.display = 'block';
                            blocks[(i*4)+j].style.backgroundColor = '#DAD9FF';
                            break;
                            case 128:
                            blocks[(i*4)+j].style.display = 'block';
                            blocks[(i*4)+j].style.backgroundColor = '#E8D9FF';
                            break;
                            case 256:
                            blocks[(i*4)+j].style.display = 'block';
                            blocks[(i*4)+j].style.backgroundColor = '#F15F5F';
                            break;
                            case 512:
                            blocks[(i*4)+j].style.display = 'block';
                            blocks[(i*4)+j].style.backgroundColor = '#F2CB61';
                            break;
                            case 1024:
                            blocks[(i*4)+j].style.display = 'block';
                            blocks[(i*4)+j].style.backgroundColor = '#E5D85C';
                            break;
                            case 2048:
                            blocks[(i*4)+j].style.display = 'block';
                            blocks[(i*4)+j].style.backgroundColor = '#86E57F';
                            break;
                        }
                }
            }
        }

        function checkmove(){
            for(let x = 0; x < 4 ; x++){
                for(let y = 0; y < 4; y++){ 
                    if(board[x][y]!=check[x][y]){
                        move = true;
                    }
                }
            }
            
            if(move == true){
                newblock(); 
                score = score + 1;
                scoretext = document.getElementById('scoretext');
                scoretext.innerText = score+""
            }
        }

        function newblock(){
            while(true){
                var x = parseInt(Math.random() * 3.99);
                var y = parseInt(Math.random() * 3.99);
                if(board[x][y]==0){   
                    board[x][y]= 2;
                    break;
                }
            }
        }

        function newblock4(){
            while(true){
                var x = parseInt(Math.random() * 3.99);
                var y = parseInt(Math.random() * 3.99);
                if(board[x][y]==0){   
                    board[x][y]= 4;
                    break;
                }
            }
        }

        function first(){
            var rand =  parseInt(Math.random() * 2.99);
            switch (rand) {
                case 0:
                    newblock();
                break;
                case 1:
                    newblock4();
                break;
                case 2:
                    newblock();
                    newblock4();
                break;
            }
        }

        function start(){
            gamestate = true;
            gamewin = false;
            gameover = false;
            score = 0;
            var scoretext = document.getElementById('scoretext');
            scoretext.innerText = score+""
            for(let i= 0; i<4;i++){
                for(let j= 0; j<4;j++){
                    board[i][j]=0;
                }
            }
            first();
            draw();

            var app = document.getElementById('app');
            var unstart = document.getElementById('unstart');
            var win = document.getElementById('win');
            var gameo = document.getElementById('gameo');

            app.style.display = 'grid';
            unstart.style.display = 'none';
            win.style.display = 'none';
            gameo.style.display = 'none';
        }
        
        function resetpx(){
            for(let i= 0; i<4;i++){
                for(let j= 0; j<4;j++){
                    moveTpx[i][j] = 20+(150*i);
                    moveLpx[i][j] = 20+(150*j);
                    temp[i][j] = 0;
                    moveComplete[i][j] = 0;
                    console.log(moveTpx[i][j]);
                    console.log(moveLpx[i][j]);
                    console.log(moveAfter[i][j]);
                }
            }
            console.log(moveTpx);
            console.log(moveLpx);
            console.log(moveAfter);
        }

        function LeftAnimation(){
            blocks = document.getElementsByClassName("block");
            
            var endani = 0;

            for(let i= 0; i<4;i++){
                for(let j= 0; j<4;j++){
                    moveComplete[i][j] = 20+(150*moveAfter[i][j]);
                }
            }

            for(let i= 0; i<4;i++){
                for(let j= 0; j<4;j++){
                    if(check[i][j]!=0){
                        if(moveLpx[i][j]>=(moveComplete[i][j]+1)){
                            moveLpx[i][j] = moveLpx[i][j]-10;
                            blocks[(i*4)+j].style.left = moveLpx[i][j];
                            console.log("이동중");
                        }else{
                            temp[i][j] = 1;
                        }  
                    }else{
                        temp[i][j] = 1;
                    }
                    endani = endani + temp[i][j];
                }
            }
            if(endani==16){
                clearInterval(intervalId);
                console.log("끝");
                checkmove();
                draw();
            }
        }

        function rightAnimation(){
            blocks = document.getElementsByClassName("block");
            
            var endani = 0;
            
            for(let i= 0; i<4;i++){
                for(let j= 0; j<4;j++){
                    moveComplete[i][j] = 20+(150*(moveAfter[i][j]))
                }
            }

            for(let i= 0; i<4;i++){
                for(let j= 0; j<4;j++){
                    if(check[i][j]!=0){
                        if(moveLpx[i][j]<=(moveComplete[i][j]-1)){
                            moveLpx[i][j] = moveLpx[i][j]+10;
                            blocks[(i*4)+j].style.left = moveLpx[i][j];
                            console.log("이동중");
                        }else{
                            temp[i][j] = 1;
                        }  
                    }else{
                        temp[i][j] = 1;
                    }
                    endani = endani + temp[i][j];
                }
            }
            if(endani==16){
                clearInterval(intervalId);
                console.log("끝");
                checkmove();
                draw();
            }
        }

        function upAnimation(){

        }

        function downAnimation(){

        }
    

    function openfile(){ // Q.1 Memory Pool을 만들어서 객체를 재활용할 수 있도록 로직을 개선하시오 
    for(let i= 0; i<4;i++){
            for(let j= 0; j<4;j++){
                var app = document.getElementById('app');
                var div = document.createElement('div');
                div.className = 'block';
                app.appendChild(div);
                
            }
        }
        blocks = document.getElementsByClassName("block");
    }

    function keydown(e){
            if(onoff==false){
                console.log(e.key);
            endG();
            if(gamestate==true){
                compute(e.key);
            }
            endG();
            onoff = true;
            }
        }

    function keyup(){
            onoff=false;
        }



window.onkeydown = keydown;
window.onkeyup = keyup;
    </script>
    
</body>
</html>
